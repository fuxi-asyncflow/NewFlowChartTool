# 流程图项目

## 基本操作

项目的基本操作包括新建，打开，保存，生成，以及关闭操作。当流程图接入工具后常用的就是 打开，保存与生成。

- 打开: 项目的第一次打开要通过菜单或工具栏完成，之后打开过的项目与流程图会显示在开始页上，鼠标点击即可直接打开。
- 保存: 保存当前编辑过的内容，请注意在提交前，一定要做一次生成后再提交。
- 生成: 项目生成时会自动保存当前的项目。

!!! note
    流程图的保存与生成做成两个操作，是因为某些项目太大时，生成时间过长会影响使用体验。所以平时编辑时可以只使用保存操作，当编辑完成准备运行或提交时，再进行一次生成操作。

## 项目结构

一个流程图项目包含以下文件：

- `project.json` 项目的配置文件，详细的配置内容见后文
- `graph` 文件夹: 保存流程图文件，里面是一些 yaml 文件，每个 yaml 文件里面可以保存一个或多个流程图
- `types` 文件夹: 保存流程图使用的类型信息与事件信息，每个类型对应的一个 yaml 文件
- `generate` 文件夹: 用于存放生成的文件，可以根据需要配置到其它位置

## 项目配置

项目的配置信息都保存在流程图项目根目录下的 `project.json` 文件里面，里面包含以下字段：

| 字段 | 说明 |
| ------ | ------ |
| `graph_roots` | 数组的每一项，代表着一个流程图的根目录，其中 <ul><li>`name`: 根目录的名称</li><li>`path`: 保存路径，默认为`graph`文件夹</li><li>`output`: 生成文件的路径，默认为`generate`可以配置到其它位置</li><li>`type`: 该目录下的流程图可挂载的游戏对象类型<sup>`*`</sup></li><li>`save_rule`: 该目录下的流程图文件的保存规则<sup>`**`</sup></li></ul>  |
| `output` | 配置通用文件的输出路径 |
| `standalone_generate_file` | 功能未开放，不要改动 |
| `code_generator` | 配置生成节点代码的类型，默认为 `lua` |

`*` 目录中的流程图可以配置为其它类型

`**` 一共有三种配置规则:

- `per_graph`: 每个流程图保存到一个 yaml 文件中
- `per_root`: 每个根目录下的所有流程图都保存到一个 yaml 文件中
- `per_root_child`: 根目录下的每个文件夹中的流程图保存到一个 yaml 文件中

!!! note 配置规则的选择
    推荐选择`per_root_child`，原因是
    
    + `per_graph` 模式的缺点是策划每次新增流程图后，要记得将其对应的 yaml 文件添加到 svn 或 git 中。此外如果项目流程图数量过多，大量的小文件对加载速度有一定的影响。
    + `per_root` 模式下，根目录的所有流程图都保存在一个文件里面，多人同时编辑根目录下的不同流程图时，容易产生冲突。
    + `per_root_child`，只需要合理地规划和创建根目录下的文件夹，策划平时在里面添加流程图不需要关心向svn添加文件的问题，而且冲突的情况也会大大减少。
    

