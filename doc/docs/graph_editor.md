# 流程图的编辑

## 流程图中的节点

### 节点的类型

在流程图中，节点有四种颜色：

| 颜色 | 说明 |
| ---- | ---- |
| 绿色 | 条件节点(Condition), 节点中的表达式有返回值 |
| 蓝色 | 行为节点(Action)，节点调用的接口无返回值，因此正常情况下默认返回 True |
| 黄色 | 等待节点(Wait)， 节点为定时器节点，等待节点或子图节点 |
| 红色 | 节点存在语法错误 |

### 节点的基本操作

节点的相关操作如下：

| 操作 | 说明 |
| ---- | ---- |
| 新增节点 | 选中节点后 `Enter` 键，可在该节点下方新建一个节点 |
| 插入节点 | 选中线条后 `Enter` 键，可在线条中间新建一个节点 |
| 编辑节点 | 选中节点后 `Space` 键，即使该节点进入编辑状态 |
| 删除节点 | 选中节点后 `Delete` 键，删除当前节点，删除后若其子节点没有其它父节点，则会自动挂载到当前节点的父节点上 |

## 流程图中的线条

### 线条的类型

在流程图中，线条共有四种颜色：红，绿，蓝，灰

| 颜色 | 说明 |
| ---- | ---- |
| 绿色 | 父节点返回 True 时，会执行绿线相连的子节点 |
| 红色 | 父节点返回 False 时，会执行红线相连的子节点 |
| 蓝色 | 父节点执行结束(节点执行没有出错)后，会执行蓝色相连的子节点，即 蓝=绿+红 |
| 灰色 | 由于删除操作导致节点没有父节点时，会用灰线将其与邻近的节点用灰线相连，可以视作该线条不存在 |

### 线条的操作

| 操作 | 说明 |
| ---- | ---- |
| 新建连线 | 在开始节点上右键，选择连接节点，再选中目标节点。在空白处单击可取消连线 |
| 改变颜色 | 选中线条后 `Tab` 键，可在切换线条的颜色 |
| 删除连线 | 选中线条后 `Delete` 键，删除连线。若子节点无其它父节点，则线条变为灰色 |

## 流程图中的变量

流程图中的变量属于黑板变量，仅可在当前流程图中使用。在节点中以 `$var_name` 的方式来访问和修改变量。当前流程图中所有的变量在画面区域的左上角显示。

变量分为两种类型：

+ 一种是传入参数，即流程图启动时，或是作为子图在其它流程图中使用时，以参数形式传入的变量
+ 一种则是普通的变量，即需要在流程图内部赋值和使用的变量

两种变量在流程图内部节点的使用上没有任何的区别。

### 变量的操作

变量的添加有两种方式：

1. 在变量面板处，通过添加按钮来新增变量
2. 在节点中写入 `$var_name = XXXX` 时，如果该变量不存在，则会自动添加该变量，类型会根据赋值语句右侧表达式的类型自动推断

变量的删除则只能通过变量面板中的删除按钮来完成。一个变量即使流程图中没有任何一个节点使用，也不会自动删除。后面会考虑增加检测未使用到的变量的功能。

## 子图

流程图可以相互调用，即流程图可以像对象上的普通方法一样，在流程图的节点中使用。这种流程图称为子图，需要在流程图编辑区域的左上角进行设置。

子图根据使用范围的不同，可以分为两种类型：

+ 局部子图：该子图仅可在同一文件夹下的其它流程图中使用，注意不包括子文件夹下的流程图。
+ 全局子图：该子图可在任意的流程图中使用

此外如果想在流程图中使用其它文件夹中的局部子图，则需要在流程图中进行引入（此功能还未实现）

!!! note
    子图的使用范围进行这样的区分是为了解决子图重名的问题。
    
    如果子图设计为可在任意的流程图中使用，即只存在全局子图。那么当两个策划各自实现了一个怪物攻击的子图，分别叫 `AI.First.attack` 与 `AI.Second.attack`时，这两个子图对应的接口名称都是 `attack`。 
    
    此时在一个流程图中使用 `$monster.attack()` 时，工具无法准确知道应当调用哪个子图。
